pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
	poke(0x5f2d,1)
	poke(0x5f5c,255)
	
	fws={}
	spks={}
	cur={}
	
	mprim=false
	mfired=false
end

function _draw()
	cls()
	pset(cur.x,cur.y,7)
	
	for a in all(fws) do
		pset(a.x,a.y,4)
	end
	
	for a in all(spks) do
		pset(a.x,a.y,a.clr)
	end
	
	print(count(fws)..' '..count(spks),0,0,7)
end

function _update()
	cur.x=stat(32)
	cur.y=stat(33)
	
	if (stat(34)!=1) mfired=false
	if (stat(34)==1 and mfired==false) then
		mprim=true
		mfired=true
	end
	
	if (mprim and count(fws)<=5) then
		add(fws,createfirework(cur.x,cur.y))
		mprim=false	
	end
	
	-- update firework pos --
	
	local tempmt={}
	for a in all(fws) do
		if (a.v<=0) then
			clr=rnd(5)+8
			for b=0,rnd(10)+20 do			
				add(spks,createsparks(a.x,a.y,clr))
			end
		else
			a.y-=a.v
			if (a.y<127) add(tempmt,a) 
			a.v-=0.5
		end
	end
	fws=tempmt
	
	-- update sparks pos --
	
	tempmt={}
	for a in all(spks) do
		a.x+=a.vx
		a.y+=a.vy
		a.vy+=0.2
		if (a.y<127) add(tempmt,a)
	end
	spks=tempmt
end
-->8
function createfirework(x,y)
	local fw={}
	fw.x=x
	fw.y=y
	fw.v=8
	return fw
end

function createsparks(x,y,clr)
	local fws={}
	fws.x=x
	fws.y=y
	fws.vx=rnd(6)-3
	fws.vy=rnd(6)-3
	fws.life=rnd(12)
	fws.clr=clr
	return fws
end
__gfx__
00000000770000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000770000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000770000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000077777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
